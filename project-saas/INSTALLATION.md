# نصب و راه‌اندازی سیستم SaaS چت معنوی

این راهنما مراحل آماده‌سازی، نصب و استقرار پروژه را روی هاست مجهز به **cPanel** با پشتیبانی از Node.js و MySQL شرح می‌دهد. این پروژه شامل سه بخش اصلی است: پایگاه داده MySQL، سرویس بک‌اند (Express.js) و رابط کاربری فرانت‌اند (React). 

## پیش‌نیازها

1. **هاست cPanel** با دسترسی به MySQL و امکان اجرای Node.js.
2. **Node.js** نسخه 18 یا بالاتر روی هاست یا محیط توسعه محلی.
3. **npm** (همراه Node.js نصب می‌شود).
4. یک کاربر پایگاه داده MySQL با دسترسی ایجاد/ویرایش جداول.

## مراحل راه‌اندازی پایگاه داده

1. وارد بخش **phpMyAdmin** در cPanel شوید و یک پایگاه داده جدید به‌نام دلخواه (مثلاً `spiritual_chat`) ایجاد کنید.
2. کاربر پایگاه داده را به این دیتابیس متصل کنید و دسترسی‌های لازم (SELECT، INSERT، UPDATE، DELETE، CREATE) را بدهید.
3. فایل `database.sql` موجود در پوشه `project-saas` را دانلود و محتویات آن را در تب **Import** یا **SQL** در phpMyAdmin اجرا کنید. این اسکریپت تمام جداول لازم (مانند users، conversations، messages و غیره) را ایجاد می‌کند.

## پیکربندی و راه‌اندازی بک‌اند

1. پوشه `backend` موجود در `project-saas` را به هاست خود (مثلاً مسیر `/home/username/nodeapp`) منتقل کنید.
2. داخل پوشه `backend` یک فایل `.env` بسازید و متغیرهای زیر را بر اساس اطلاعات هاست خود مقداردهی کنید:

   ```env
   DB_HOST=localhost
   DB_PORT=3306
   DB_USER=نام_کاربر_دیتابیس
   DB_PASSWORD=رمز_عبور_دیتابیس
   DB_NAME=نام_پایگاه_داده
   JWT_SECRET=کلید_محرمانه_تصادفی
   PORT=3001
   ```

3. در خط فرمان، وارد پوشه `backend` شوید و دستور زیر را اجرا کنید تا وابستگی‌های پروژه نصب شوند:

   ```bash
   npm install
   ```

4. برای اجرای سرویس در محیط محلی می‌توانید دستور زیر را اجرا کنید:

   ```bash
   npm start
   ```

   سرور روی پورتی که در `.env` تعریف کرده‌اید (پیش‌فرض ۳۰۰۱) اجرا خواهد شد. اطمینان حاصل کنید این پورت در فایروال هاست شما باز است یا از طریق reverse proxy در cPanel قابل دسترس باشد.

5. در محیط cPanel برای اجرای دائمی برنامه، از بخش **Node.js Application** یک برنامه جدید تعریف کنید:
   - مسیر پروژه را بر روی پوشه `backend` تنظیم کنید.
   - فایل ورودی را `index.js` قرار دهید.
   - متغیرهای محیطی (`DB_HOST`، `DB_PORT` و غیره) را از طریق رابط کاربری تعریف نمایید.
   - پس از ایجاد، برنامه را **Start** کنید.

## راه‌اندازی فرانت‌اند

1. پوشه `project` (فرانت‌اند React) را در سیستم محلی خود نصب کنید. ابتدا وارد پوشه شوید و وابستگی‌ها را نصب نمایید:

   ```bash
   cd project
   npm install
   ```

2. برای توسعه و تست محلی، می‌توانید دستور زیر را اجرا کنید:

   ```bash
   npm run dev
   ```

   با توجه به تنظیمات فایل `vite.config.ts`، هر درخواست به مسیر `/api` به آدرس `http://localhost:3001` پروکسی می‌شود؛ بنابراین ابتدا اطمینان حاصل کنید بک‌اند در حال اجراست.

3. برای ساخت نسخه نهایی جهت استقرار، دستور زیر را اجرا کنید:

   ```bash
   npm run build
   ```

   این دستور پوشه‌ای به‌نام `dist` ایجاد می‌کند که شامل فایل‌های استاتیک آماده‌ی استقرار است.

4. برای قرار دادن فرانت‌اند روی هاست cPanel:
   - وارد **File Manager** شوید و محتویات پوشه `dist` را در پوشه‌ی public سایت (مثلاً `public_html`) آپلود کنید.
   - مطمئن شوید فایل `index.html`, `assets` و دیگر فایل‌های تولید شده صحیحاً کپی شده‌اند.
   - اگر بک‌اند و فرانت‌اند روی دامنه‌ی یکسانی قرار دارند، نیازی به تنظیم خاصی نیست؛ در غیر اینصورت می‌توانید مقدار `VITE_API_BASE_URL` را در فایل `.env` فرانت‌اند تنظیم کنید تا به آدرس بک‌اند اشاره کند.

## استفاده از برنامه

پس از انجام مراحل بالا:

1. وارد صفحه اصلی سایت شوید؛ صفحه‌ی ثبت‌نام/ورود نمایش داده می‌شود. برای ورود به پنل مدیریت، از ایمیل `admin@example.com` استفاده کنید. دیگر ایمیل‌ها به‌عنوان کاربر عادی ثبت‌نام خواهند شد.
2. پس از ورود، کاربر عادی به صفحه انتخاب مرجع هدایت می‌شود و می‌تواند گفتگو را آغاز کند. هر پیام ارسال‌شده یک توکن از موجودی کاربر کم می‌کند.
3. مدیر سیستم می‌تواند از طریق مسیر `/admin` به صفحات مدیریت کاربران، گزارش‌ها، مالی، تنظیمات و... دسترسی داشته باشد.

## نکات مهم

- این پیاده‌سازی ساده به‌منظور نمایش ساختار کلی و امکانات پروژه است؛ در محیط واقعی حتماً برای ذخیره تنظیمات و حفاظت بیشتر از داده‌ها، تغییرات بیشتری اعمال کنید.
- لایه احراز هویت از توکن JWT استفاده می‌کند و نمونه‌ی تولید شده دارای تاریخ انقضا یک‌هفته‌ای است. در صورت نیاز این مقدار را در `index.js` تغییر دهید.
- بخش گفت‌وگو با هوش مصنوعی در این نسخه پاسخ‌های شبیه‌سازی‌شده تولید می‌کند. برای اتصال به مدل واقعی باید مسیر `/api/v1/messages` را در بک‌اند به سرویس موردنظر متصل کنید.